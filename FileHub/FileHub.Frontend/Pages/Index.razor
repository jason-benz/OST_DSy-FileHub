@page "/"
@inject IJSRuntime JSRuntime
@using FileHub.Frontend.Datahandling
@using FileHub.Service.Datahandling
@using FileHub.Frontend.Network
@using System.Net.WebSockets

<PageTitle>FileHub</PageTitle>

<h1>Welcome to FileHub</h1>
<div class="row row-cols-7">
    <div class="card col-3">
        <div class="card-body">
            <h5 class="card-title">Share files</h5>
            <p class="card-text">You can share files with your friends</p>
            <a href="/ShareFiles" class="btn btn-primary">Share files</a>
        </div>
    </div>
    <div class="col-1"></div>
    <div class="card col-3">
        <div class="card-body">
            <h5 class="card-title">Get shared files</h5>
            <p class="card-text">You can get access to your friends shared files</p>
            <label>Enter code</label>
            <input type="text" />
            <button class="btn btn-primary" @onclick="GetFiles">Get files</button>
        </div>
    </div>
</div>

@code {
    private async Task GetFiles()
    {
        IBinaryDataHandler data = new BinaryDataHandler();
        WebsocketClient client = new (new ClientWebSocket());

        var filename = "file.txt"; // TODO: Replace filename
        var filetype = "text/plain"; // TODO: Replace filetype

        await client.Connect($"ws://localhost:8080/dataservice/receive/1/{filename}");
        var bytes = await client.Receive(data);

        await JSRuntime.InvokeVoidAsync("DownloadFile", filename, filetype, bytes);
        client.Close();
    }

}